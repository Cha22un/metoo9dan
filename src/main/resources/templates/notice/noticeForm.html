<!--이 파일을 복사하여 templates/본인기능폴더 하위에 추가하여 작업해주세요-->
<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content" class="container my-3">
    <div class="row">
        <!--<div th:replace="~{각페이지에맞는사이드바파일경로::sidebar}"></div>-->
        <div th:replace="~{/notice/manageSidebar::sidebar}" ></div>

        <div style="border: 1px solid black;" class="col-10"> <!--class에서 col-10은 빼면 안됨-->
            <!-- 맡은 기능 구현 하시면 됩니다! -->
            <h2>공지사항 게시글 등록</h2>
<!--            <div th:replace="~{form_errors::formErrorsFragment}"></div>-->
            <form id="noticeForm" th:object="${noticeForm}" th:action="@{|/notice/add|}" method="post">
                <input type="hidden" th:field="*{postDate}">
                <select th:field="*{noticeType}">
                    <option value="">분류를 선택하세요</option>
                    <option value="noti">공지사항</option>
                    <option value="faq">자주묻는질문</option>
                </select>
                <label for="isImp1"><input type="checkbox" th:field="*{isImp}"> 중요글로 상단 노출</label>
                <hr/>
                제목
                <input type="text" th:field="*{title}" placeholder="제목을 입력하세요"><br/>
                게시여부
                <label for="status1">
                    <input type="radio" value="IMMEDIATE" th:field="*{status}" onclick="disableDateInput()">등록 즉시 게시
                </label>
                <label for="status2">
                    <input type="radio" value="SCHEDULED" th:field="*{status}" onclick="enableDateInput()">게시 일자
                    <input type="date" id="selectDate" name="selectDate">
                </label>
                <br/>
                내용
                <textarea th:field="*{content}" rows="6" placeholder="내용을 입력하세요"></textarea>
                <br/>
                첨부파일 (파일 1개당 최대 첨부용량: 30MB)
                <div style="border: 1px solid black;">마우스로 파일을 끌어 놓으세요.</div>
                <input type="button" onclick="saveForm()" value="게시글 저장">
                <!--<input type="submit" value="게시글 저장">-->
            </form>
        </div><!--콘텐츠영역끝-->
    </div><!--row-->
</div><!--container-->
<div layout:fragment="script">
<script th:inline="javascript">
    // 게시일자 라디오를 선택하면 날짜 선택 부분이 활성화
    function disableDateInput() {
        document.getElementById('selectDate').disabled = true;
    }

    function enableDateInput() {
        document.getElementById('selectDate').disabled = false;
    }

    function saveForm() {
        if(checkForm()){ //유효성검사 마쳤으면,
            if(document.getElementById("status1").checked){ //등록즉시 게시 선택시
                var today = /*[[${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}]]*/ '';
                document.getElementById("postDate").value = today;
                document.getElementById("noticeForm").submit(); // 폼 제출
            } else if(document.getElementById("status2").checked){ //예약게시 선택시
                document.getElementById("postDate").value = document.getElementById("selectDate").value;
                document.getElementById("noticeForm").submit(); // 폼 제출
            }
        }
    }


    function checkForm() {
        // 제목 유효성 검사
        var title = document.getElementById("title").value;
        if (title.trim() === "") {
            alert("제목을 입력하세요.");
            return false;
        }

        // 분류 선택 여부 확인
        var noticeType = document.getElementById("noticeType").value;
        if (noticeType === "") {
            alert("분류를 선택하세요.");
            return false;
        }

        // 내용 유효성 검사
        var content = document.getElementById("content").value;
        if (content.trim() === "") {
            alert("내용을 입력하세요.");
            return false;
        }

        // 게시여부 선택 여부 확인
        var postChecked = document.getElementById("status1").checked;
        var notPostChecked = document.getElementById("status2").checked;

        if (!postChecked && !notPostChecked) {
            alert("게시여부를 선택하세요.");
            return false;
        }

        // 게시일자 선택 여부 확인
        if (notPostChecked) {
            var selectDate = document.getElementById("selectDate").value;
            var postDate = new Date(selectDate);
            if(isNaN(postDate.getTime())){
                alert("게시 일자를 선택하세요.");
                return false;
            }
        }

        // 모든 유효성 검사 통과 시 true 반환
        console.log('유효성검사 끝');
        return true;
    }

</script>
</div>
</html>