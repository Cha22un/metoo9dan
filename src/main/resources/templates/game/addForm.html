<html layout:decorate="~{layout}" xmlns:th="http://www.thymeleaf.org">
<div layout:fragment="content" class="container my-3">
    <div class="row">
        <!--<div th:replace="~{각페이지에맞는사이드바파일경로::sidebar}"></div>-->
        <div th:replace="~{/test/testSidebar::sidebar}"></div> <!--테스트 사이드바 경로를 넣어놓음-->
        <div style="border: 1px solid black;" class="col-10"> <!--class에서 col-10은 빼면 안됨-->
            <form id="gameadd" class="my-2" th:object="${gameVaildation}" th:action="@{/game/add}" method="post" enctype="multipart/form-data" onsubmit="prepareForm()">
            <div>
                <!-- 게임콘텐츠명 -->
                <div class="mb-3 row">
                    <label for="game_name" class="col-sm-2 col-form-label">게임콘텐츠명</label>
                    <div class="col-sm-5">
                        <input type="text" th:field="*{game_name}" class="form-control">
                        <span th:if="${#fields.hasErrors('game_name')}" th:errors="*{game_name}" class="error-message text-danger"></span>
                    </div>
                </div>
                <!-- 학습난이도 -->
                <div class="mb-3 row">
                    <label for="difficulty" class="col-sm-2 col-form-label">학습난이도</label>
                    <div class="col-sm-3">
                        <select th:field="*{difficulty}" class="form-select">
                            <option value="beginner">초급</option>
                            <option value="intermediate">중급</option>
                            <option value="advanced">고급</option>
                        </select>
                    </div>
                </div>
            <!-- 구독기간 -->
                    <div class="mb-3 row">
                        <label for="subscription_duration" class="col-sm-2 col-form-label">구독기간</label>
                        <div class="col-sm-3">
                            <input type="number" th:field="*{subscription_duration}" class="form-control" placeholder="일 단위로 입력해주세요.">
                        </div>
                    </div>
            <!-- 구독가능인원 -->
                    <div class="mb-3 row">
                        <label for="max_subscribers" class="col-sm-2 col-form-label">구독가능인원</label>
                        <div class="col-sm-3">
                            <input type="number" th:field="*{max_subscribers}" class="form-control">
                        </div>
                    </div>
                <!-- 정가 -->
                <div class="mb-3 row">
                    <label for="original_price" class="col-sm-2 col-form-label">정가</label>
                    <div class="col-sm-3">
                        <input type="text" th:field="*{original_price}" class="form-control" id="original_price" oninput="addCommas(this)">
                    </div>
                </div>
                <!-- 할인율 -->
                <div class="mb-3 row">
                    <label for="discount_rate" class="col-sm-2 col-form-label">할인율</label>
                    <div class="col-sm-3">
                        <div class="input-group"> <!-- Input 그룹을 사용하여 입력 필드와 % 기호를 함께 표시 -->
                            <input type="text" th:field="*{discount_rate}" class="form-control" id="discount_rate">
                            <span class="input-group-text">%</span> <!-- Input 그룹의 추가 텍스트로 % 기호를 추가 -->
                        </div>
                        <small class="text-muted ms-1">적용 버튼을 눌러 판매가를 적용하세요.</small>
                    </div>
                    <div class="col-sm-1">
                        <button type="button" class="btn btn-primary" onclick="calculateSalePrice()">적용</button>
                    </div>
                </div>
                <!-- 판매가 -->
                <div class="mb-3 row">
                    <label for="sale_price" class="col-sm-2 col-form-label">판매가</label>
                    <div class="col-sm-3">
                        <input type="text" th:field="*{sale_price}" class="form-control" id="sale_price" readonly oninput="addCommas(this)">
                    </div>
                </div>
                <!-- 패키지내용 -->
                <div class="mb-3 row">
                    <label for="package_details" class="col-sm-2 col-form-label">패키지내용</label>
                    <div class="col-sm-10">
                        <textarea class="form-control" th:field="*{package_details}" rows="8" placeholder="내용을 입력해주세요."></textarea>
                    </div>
                </div>
                <!-- 파일 업로드 -->
                <div class="mb-5 row">
                    <label for="boardFile" class="col-sm-2 col-form-label">썸네일</label>
                 <!--   <input class="form-control" type="file" th:field="*{origin_file_name}">-->
                    <div class="col-sm-5">
                    <input class="form-control" type="file" th:field="*{boardFile}" multiple>
                    </div>
                </div>
                <!-- 학습자료 조회 -->



                <div class="mb-3 text-center">
                    <button type="submit" class="btn btn-primary">등록하기</button>
                </div>
            </div>
            </form>
        </div>
    </div>
    <script>
        function addCommas(inputElement) {
            // 입력된 값을 부동 소수점 숫자로 변환하고 콤마를 추가하여 다시 설정합니다.
            var value = inputElement.value.replace(/,/g, ''); // 입력된 콤마를 제거
            value = parseFloat(value).toLocaleString('en-US');
            inputElement.value = value;
        }

        function formatPrice(price) {
            // 콤마가 추가된 값을 콤마를 제거하고 부동 소수점 숫자로 변환합니다.
            return parseFloat(price.toString().replace(/,/g, ''));
        }

        function calculateSalePrice() {
            var originalPrice = formatPrice(document.getElementById('original_price').value);
            var discountRate = parseFloat(document.getElementById('discount_rate').value);

            if (!isNaN(originalPrice) && !isNaN(discountRate)) {
                var salePrice = originalPrice * (1 - discountRate / 100);

                // 판매가를 소수점 첫 번째 자리에서 반올림하고, 부동 소수점 숫자로 변환한 후 콤마를 추가하여 표시합니다.
                var roundedSalePrice = Math.round(salePrice);
                document.getElementById('sale_price').value = roundedSalePrice.toLocaleString('en-US');
            }
        }

    function prepareForm() {
        // 폼을 제출하기 전에 콤마를 제거하고 숫자 값으로 판매가 필드를 업데이트합니다.
        var salePriceInput = document.getElementById('sale_price');
        salePriceInput.value = salePriceInput.value.replace(/,/g, ''); // 판매가 필드에서 콤마 제거

         var originalpriceInput = document.getElementById('original_price');
        originalpriceInput.value = originalpriceInput.value.replace(/,/g, ''); // 정가 필드에서 콤마 제거
    }
    </script>
</div>
</html>