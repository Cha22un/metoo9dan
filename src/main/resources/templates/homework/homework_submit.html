            <canvas id="canvas"></canvas>

            <div style="display:none;">
                <button id="startButton"></button>
                <button id="stopButton"></button>
            </div>

            <!-- 숙제 목록 -->
            <input type="text" id="homeworkSearchInput" onkeyup="searchTable()" placeholder="검색어를 입력하세요..">
            <table id="homeworkTable">
                <thead>
                <tr>
                    <th>No</th>
                    <th>숙제 제목</th>
                    <th>게임 컨텐츠명</th>
                    <th>진도</th>
                    <th>제출 기한</th>
                    <th>제출</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="hs,start : ${homeworkSend}"
                    th:data-send-no="${hs.sendNo}"
                    th:class="${hs.isSubmit != 'N' ? 'submitted' : 'not-submitted'}"
                    ondblclick="loadForm(this)">
                    <td th:text="${homeworkSend.size() - start.count + 1}"></td>
                    <td th:text="${hs.homeworks.homeworkTitle}"></td>
                    <td th:text="${hs.homeworks.gameTitle}"></td>
                    <td th:text="${hs.homeworks.progress}"></td>
                    <td th:text="${hs.homeworks.dueDate}"></td>
                    <td th:text="${hs.isSubmit != 'N' ? '제출 완료' : '제출 전'}"></td>
                </tr>
                </tbody>
            </table>
            <!-- 페이지네이션 부분 -->
            <div id="homeworkPagination">
                <button id="homeworkPrevBtn" onclick="homeworkPrevPage()">이전</button>
                <div id="homeworkPageNumbers"></div>
                <button id="homeworkNextBtn" onclick="homeworkNextPage()">다음</button>
            </div>

            <div class="submit-form" style="display:none;">
                <form id="addForm" th:action="@{/homework/submit/add}" th:object="${hwSubmitForm}" method="post">
                    <div class="book">
                        <div class="cover"></div>
                        <div class="index"></div>
                        <div class="page left page1"></div>
                        <div class="page left page2"></div>
                        <div class="page left page3">
                            <p>숙제 제목: <span class="homework-title"></span></p>
                            <p>게임 컨텐츠명: <span class="game-title"></span></p>
                            <p>진도: <span class="progress"></span> 레벨</p>
                            <p>숙제 내용: <span class="homework-content"></span></p>
                            <p>교육자: <span class="member-name"></span></p>
                            <p>제출 기한: <span class="due-date"></span></p>
                        </div>
                        <div class="page right page1"></div>
                        <div class="page right page2"></div>
                        <div class="page right page3">
                                <p>진도: <span class="currentLevel"></span> 레벨</p>
                                <input type="hidden" name="homeworkNo"/>
                                <input type="hidden" name="sendNo"/>
                                <textarea name="homeworkContent" placeholder="숙제 내용을 입력하세요."></textarea>
                                <span id="homeworkContentError" class="error-message"></span>
                                <textarea name="additionalQuestion" placeholder="추가 질의 사항을 입력하세요."></textarea>
                                <button type="submit">제출</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="edit-form" style="display:none;">
                <div class="book">
                    <div class="cover"></div>
                    <div class="index"></div>
                    <div class="page left page1"></div>
                    <div class="page left page2"></div>
                    <div class="page left page3">
                        <p>숙제 제목: <span class="homework-title"></span></p>
                        <p>게임컨텐츠명: <span class="game-title"></span>레벨</p>
                        <p>진도: <span class="progress"></span>레벨</p>
                        <p>교육자: <span class="member-name"></span></p>
                        <p>숙제 내용: <span class="homework-content"></span></p>
                        <p>제출 기한: <span class="due-date"></span></p>
                    </div>
                    <div class="page right page1"></div>
                    <div class="page right page2"></div>
                    <div class="page right page3">
                        <form id="editForm" th:action="@{/homework/submit/edit}" th:object="${hwSubmitForm}" method="post">
                            <p>진도: <span class="currentLevel"></span>레벨</p>
                            <input type="hidden" name="homeworkNo"/>
                            <input type="hidden" name="homeworkSubmitNo"/>
                            <input type="hidden" name="sendNo"/>
                            <textarea name="homeworkContent" placeholder="숙제 내용을 입력하세요."></textarea>
                            <span id="homeworkEditContentError" class="error-message"></span>
                            <textarea name="additionalQuestion" placeholder="추가 질의 사항을 입력하세요."></textarea>
                            <button type="submit">수정</button>
                            <button type="button" id="deleteBtn">삭제</button>
                        </form>
                    </div>
                </div>
            </div>


            <div id="successModal" class="bs-modal">
                <div class="bs-modal-dialog">
                    <div class="bs-modal-content">
                        <div class="bs-modal-header">
                            <h5 class="bs-modal-title">제출 성공!</h5>
                        </div>
                        <div class="bs-modal-body">
                            <p>~숙제 완료~ 나도 9단이 될 수 있다!</p>
                        </div>
                        <div class="bs-modal-footer">
                            <button id="modalCloseBtn" class="btn-close"></button>
                        </div>
                    </div>
                </div>
            </div>

            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
            <script src="https://tistory4.daumcdn.net/tistory/3134841/skin/images/confetti_v2.js"></script>
            <script>
                function reAction(){
                console.log('폭죽 불붙음');
                 $("#startButton").trigger("click");

                 setTimeout(function(){
                 $("#stopButton").trigger("click");
                 }, 5000);
                }

                let homeworkCurrentPage = 1;
                const homeworkRowsPerPage = 5;

                function homeworkGetTotalRowCount() {
                    return $("#homeworkTable tbody tr:not(.filtered-out)").length;
                }

                function homeworkGetVisibleRowCount() {
                    return $("#homeworkTable tbody tr:visible").length;
                }

                function homeworkUpdatePagination() {
                    let totalRows = homeworkGetTotalRowCount();
                    homeworkCurrentPage = 1;
                    homeworkUpdateTableDisplay();
                }

                function homeworkSearchTable() {
                    let input, filter, table, tr, td, i, j, found;
                    input = document.getElementById("homeworkSearchInput");
                    filter = input.value.toUpperCase();
                    table = document.getElementById("homeworkTable");
                    tr = table.getElementsByTagName("tr");
                    let foundCount = 0;

                    $("#noSearchResult").remove();

                    for (i = 1; i < tr.length; i++) {
                        td = tr[i].getElementsByTagName("td");
                        found = false;
                        for (j = 0; j < td.length; j++) {
                            if (td[j]) {
                                if (td[j].innerHTML.toUpperCase().indexOf(filter) > -1) {
                                    found = true;
                                    break;
                                }
                            }
                        }
                        if (found) {
                            $(tr[i]).removeClass("filtered-out");
                            foundCount++;
                        } else {
                            $(tr[i]).addClass("filtered-out");
                        }
                    }

                    if (foundCount == 0) {
                        $("#homeworkTable").hide();
                        $("#homeworkPagination").hide();
                        $("#homeworkTable").after('<p id="noSearchResult">검색 결과가 없습니다</p>');
                    } else {
                        $("#homeworkTable").show();
                        $("#homeworkPagination").show();
                    }

                    homeworkUpdatePagination();
                }

                function homeworkRenderPagination() {
                    let totalRows = homeworkGetTotalRowCount();
                    let totalPages = Math.ceil(totalRows / homeworkRowsPerPage);

                    let startPage = homeworkCurrentPage - 2;
                    let endPage = homeworkCurrentPage + 2;

                    if (startPage < 1) {
                        endPage -= (startPage - 1);
                        startPage = 1;
                    }
                    if (endPage > totalPages) {
                        startPage -= (endPage - totalPages);
                        endPage = totalPages;
                    }
                    startPage = Math.max(1, startPage);

                    let paginationHtml = '';
                    for (let i = startPage; i <= endPage; i++) {
                        paginationHtml += `<span class="hw-page-number ${i === homeworkCurrentPage ? 'active' : ''}" data-page="${i}">${i}</span>`;
                    }

                    $("#homeworkPageNumbers").html(paginationHtml);
                    $("#homeworkPrevBtn").prop('disabled', homeworkCurrentPage === 1);
                    $("#homeworkNextBtn").prop('disabled', homeworkCurrentPage === totalPages);
                }

                function homeworkUpdateTableDisplay() {
                    let startRow = (homeworkCurrentPage - 1) * homeworkRowsPerPage;
                    let endRow = startRow + homeworkRowsPerPage - 1;

                    $("#homeworkTable tbody tr").each(function(index, row) {
                        if (index === 0) {
                            $(row).show();
                        } else if ($(row).hasClass("filtered-out")) {
                            $(row).hide();
                        } else if (index > startRow && index <= endRow) {
                            $(row).show();
                        } else {
                            $(row).hide();
                        }
                    });

                    homeworkRenderPagination();
                }

                function homeworkPrevPage() {
                    if(homeworkCurrentPage > 1) {
                        homeworkCurrentPage--;
                        homeworkUpdateTableDisplay();
                    }
                }

                function homeworkNextPage() {
                    let totalPages = Math.ceil(homeworkGetTotalRowCount() / homeworkRowsPerPage);
                    if(homeworkCurrentPage < totalPages) {
                        homeworkCurrentPage++;
                        homeworkUpdateTableDisplay();
                    }
                }

                $(document).ready(function() {
                    homeworkUpdateTableDisplay();

                    $("#homeworkPagination").on("click", ".hw-page-number", function() {
                        homeworkCurrentPage = $(this).data('page');
                        homeworkUpdateTableDisplay();
                    });

                    $("#homeworkPrevBtn").click(function() {
                        if (homeworkCurrentPage > 1) {
                            homeworkCurrentPage--;
                            homeworkUpdateTableDisplay();
                        }
                    });

                    $("#homeworkNextBtn").click(function() {
                        let totalRows = homeworkGetTotalRowCount();
                        if (homeworkCurrentPage < Math.ceil(totalRows / homeworkRowsPerPage)) {
                            homeworkCurrentPage++;
                            homeworkUpdateTableDisplay();
                        }
                    });

                    homeworkUpdateTableDisplay();
                });


              function loadForm(element) {
                  let hwSendNo = element.getAttribute("data-send-no");
                  let isSubmitted = element.classList.contains("submitted");

                  fetch(`/homework/submit/detail/${hwSendNo}`)
                      .then(response => response.json())
                      .then(data => {
                          // 숙제 내용 채우기
                          document.querySelector(".edit-form input[name='homeworkNo']").value = data.homeworkNo;
                          document.querySelector(".edit-form input[name='sendNo']").value = data.sendNo;
                          document.querySelector(".submit-form input[name='homeworkNo']").value = data.homeworkNo;
                          document.querySelector(".submit-form input[name='sendNo']").value = data.sendNo;

                          document.querySelector(".submit-form span.homework-title").textContent = data.homeworkTitle;
                          document.querySelector(".submit-form span.homework-content").textContent = data.homeworkContent;
                          document.querySelector(".submit-form span.member-name").textContent = data.memberName;
                          document.querySelector(".submit-form span.progress").textContent = data.progress;
                          document.querySelector(".submit-form span.due-date").textContent = data.dueDate;
                          document.querySelector(".edit-form span.homework-title").textContent = data.homeworkTitle;
                          document.querySelector(".edit-form span.homework-content").textContent = data.homeworkContent;
                          document.querySelector(".edit-form span.member-name").textContent = data.memberName;
                          document.querySelector(".edit-form span.progress").textContent = data.progress;
                          document.querySelector(".edit-form span.due-date").textContent = data.dueDate;

                          document.querySelector(".edit-form span.currentLevel").textContent = data.progress;
                          document.querySelector(".submit-form span.currentLevel").textContent = data.progress;

                          if (isSubmitted) {
                              // 제출 내용으로 수정 폼 채우기
                              document.querySelector(".edit-form textarea[name='homeworkContent']").value = data.content;
                              document.querySelector(".edit-form textarea[name='additionalQuestion']").value = data.additionalQuestion;
                              document.querySelector(".edit-form input[name='homeworkSubmitNo']").value = data.homeworkSubmitNo;
                              document.querySelector(".submit-form").style.display = 'none';
                              document.querySelector(".edit-form").style.display = 'block';
                              $("#deleteBtn").data('submit-id', data.homeworkSubmitNo);
                          } else {
                              // 제출 폼 초기화 및 표시
                              document.querySelector(".submit-form textarea[name='homeworkContent']").value = '';
                              document.querySelector(".submit-form textarea[name='additionalQuestion']").value = '';
                              document.querySelector(".edit-form input[name='homeworkSubmitNo']").value = '';
                              document.querySelector(".edit-form").style.display = 'none';
                              document.querySelector(".submit-form").style.display = 'block';
                          }
                      })
                      .catch(error => {
                          console.error("There was a problem with the fetch operation:", error.message);
                      });


              }

              $(document).ready(function() {
                    $("#modalCloseBtn").click(function() {
                        location.reload(); // 페이지 리로드
                    });
                });


              // addForm 제출
              $("#addForm").submit(function(e) {
                  e.preventDefault();

                  $(".error-message").text("");  // 초기화

                  $.ajax({
                      url: $(this).attr("action"),
                      type: "POST",
                      data: $(this).serialize(),
                      success: function(response) {
                          reAction(); // 꽃가루 효과
                          $("#successModal").show(); // 모달 보이기
                      },
                      error: function(xhr) {
                          let errors = xhr.responseJSON;

                          // 에러 메시지 출력
                          if (errors.homeworkContent) {
                              $("#homeworkContentError").text(errors.homeworkContent);
                          }
                      }
                  });
              });

              // editForm 제출
              $("#editForm").submit(function(e) {
                  e.preventDefault();

                  $(".error-message").text("");  // 초기화
                  reAction();

                  $.ajax({
                      url: $(this).attr("action"),
                      type: "POST",
                      data: $(this).serialize(),
                      success: function(response) {
                          reAction(); // 꽃가루 효과
                          $("#successModal").show(); // 모달 보이기
                      },
                      error: function(xhr) {
                          let errors = xhr.responseJSON;

                          // 에러 메시지 출력
                          if (errors.homeworkContent) {
                              $("#homeworkEditContentError").text(errors.homeworkContent);
                          }
                      }
                  });
              });

                //삭제 버튼 클릭
                $("#deleteBtn").click(function(){
                    let submitId = $(this).data('submit-id');

                  if(submitId && confirm("제출한 내용을 삭제하시겠습니까?")) {
                    $.ajax({
                        url: `/homework/submit/delete/${submitId}`,
                        type: 'DELETE',
                        success: function(response) {
                            alert("숙제가 삭제되었습니다")
                            location.reload();
                            },
                        error: function(xhr, status, error) {
                            alert('삭제 실패: ' + xhr.responseText);
                            }
                        });
                    } else {
                        alert('숙제 제출 ID가 없습니다. 다시 시도해주세요.');
                    }
                });
            </script>